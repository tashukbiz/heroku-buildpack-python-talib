#!/usr/bin/env bash

echo "TA-Lib buildpack compile"

CACHE_DIR=$2

source bin/utils

PYTHON=python3.12
puts-step "Installing TA-Lib library source code"
echo "Download & unpack..." | indent
wget -q http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz > /dev/null 2>&1
tar -xf ta-lib-0.4.0-src.tar.gz  && cd ta-lib > /dev/null 2>&1
echo "Compile..." | indent
./configure --includedir=/app/.heroku/python/include/${PYTHON} --libdir=/app/.heroku/python/lib --bindir=/app/.heroku/python/bin > /dev/null 2>&1
make > /dev/null 2>&1
echo "Install..." | indent
make install > /dev/null 2>&1
echo "TA-Lib library successfully installed" | indent

rm -rf $CACHE_DIR/.heroku/python/
cp -R /app/.heroku/python/ $CACHE_DIR/.heroku/
